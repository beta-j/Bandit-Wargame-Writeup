# Bandit Level 22 -> Level 23 #

https://overthewire.org/wargames/bandit/bandit23.html

## SSH Access Details ##
**Username:**  bandit22

**Password:**  WdDozAdTM2z9DiFEQ2mGlwngMfj4EZff
#

## Level Goal : ##
>A program is running automatically at regular intervals from **cron**, the time-based job scheduler. Look in **/etc/cron.d/** for the configuration and see what command is being executed.
>
>**NOTE:** Looking at shell scripts written by other people is a very useful skill. The script for this level is intentionally made easy to read. If you are having problems understanding what it does, try executing it to see the debug information it prints.


## Commands you may need to solve this level : ##
cron, crontab, crontab(5) (use “man 5 crontab” to access this)


#  
## PROCEDURE : ##

This task is quite similar to the previous one.  If we look at `/etc/cron.d` we can see a number of cronjobs including one that's called `cronjob_bandit23`.  If we look into the contents of this cronjob we find that it is calling a bash script `/usr/bin/cronjob_bandit23.sh`

```console
bandit22@bandit:~$ ls /etc/cron.d
cronjob_bandit15_root  cronjob_bandit22  cronjob_bandit24       e2scrub_all  sysstat
cronjob_bandit17_root  cronjob_bandit23  cronjob_bandit25_root  otw-tmp-dir
bandit22@bandit:~$ cat /etc/cron.d/cronjob_bandit23
@reboot bandit23 /usr/bin/cronjob_bandit23.sh  &> /dev/null
* * * * * bandit23 /usr/bin/cronjob_bandit23.sh  &> /dev/null
```

We can use the command `cat /usr/bin/cronjob_bandit23.sh` to see what the bash script contains:

```bash
#!/bin/bash

myname=$(whoami)
mytarget=$(echo I am user $myname | md5sum | cut -d ' ' -f 1)

echo "Copying passwordfile /etc/bandit_pass/$myname to /tmp/$mytarget"

cat /etc/bandit_pass/$myname > /tmp/$mytarget
```

Let's break-down this code line-by-line
- `#!/bin/bash`: Declares this file as a bash script
- `myname=$(whoami)`: Runs the `whoami` command and saves it to a variable called `$myname`  in our case this variable will contain `bandit22` since that is our username (and therefore the output of the `whoami` command)
- `mytarget=$(echo I am user $myname | md5sum | cut -d ' ' -f 1)`:  Takes the text string `I am user bandit22` and calculates it's md5 hash value using `md5sum`, then passes this output to the `cut` command to remove spurious bits of text at the end of the generated md5 hash.  The `-d ' '` part sets the delimeter as a space and `-f 1` tells the `cut` command to only consider the first field.  The result of this opertion will be a string of text that is stored in the variable `$mytarget`
- `echo "Copying passwordfile /etc/bandit_pass/$myname to /tmp/$mytarget"`: Outputs a message to screen indicating that it is copying a specific file to the `/tmp/` directory using the previopusly-generated string as the new filename.
- `cat /etc/bandit_pass/$myname > /tmp/$mytarget`:  Copies the contents of the password file to the newly-created file


It's good to be able to read through such bash scripts and make sense of what they're doing.  However in this case it's not really necessary as we can just run the bash script and it tells us exactly what it's doing and where it saved the contents of the password file:

```console
bandit22@bandit:~$ /usr/bin/cronjob_bandit23.sh
Copying passwordfile /etc/bandit_pass/bandit22 to /tmp/8169b67bd894ddbb4412f91573b38db3
```

Now all we have to do is look at the contents of the file generated by the script to get the password for `bandit23`:
```console
bandit22@bandit:~$ cat /tmp/8169b67bd894ddbb4412f91573b38db3
WdDozAdTM2z9DiFEQ2mGlwngMfj4EZff
```
